model Quiz {
  id              String          @id @default(auto()) @map("_id") @db.ObjectId
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  title           String
  internalName    String
  introduction    String?
  questions       QuizQuestion[]
  responses       QuizResponse[]
  instructorId    String          @db.ObjectId
  instructor      Instructor      @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  lockAnswers     Boolean         @default(false)
  productLections CourseLection[]

  @@map("quizzes")
}

model QuizQuestion {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  type        QuestionType
  quizId      String       @db.ObjectId
  title       String
  question    String
  explanation String?
  quiz        Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)
  options     Json
  answers     QuizAnswer[]
  order       Int?

  @@map("quiz-questions")
}

model QuizResponse {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  contactId     String        @db.ObjectId
  contact       Contact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  quizId        String        @db.ObjectId
  quiz          Quiz          @relation(fields: [quizId], references: [id], onDelete: Cascade)
  answers       QuizAnswer[]
  completed     Boolean       @default(false)
  submittedFrom SubmittedFrom
  submittedId   String?

  @@map("quiz-responses")
}

enum SubmittedFrom {
  PRODUCT
  LANDING_PAGE
}

model QuizAnswer {
  id         String       @id @default(auto()) @map("_id") @db.ObjectId
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  questionId String       @db.ObjectId
  question   QuizQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
  responseId String       @db.ObjectId
  response   QuizResponse @relation(fields: [responseId], references: [id], onDelete: Cascade)
  answer     Json?

  @@map("quiz-answers")
}

enum QuestionType {
  MULTIPLE_CHOICE
  TEXT
  UPLOAD
  RATING
}
